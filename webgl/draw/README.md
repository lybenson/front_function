- [ ] 顶点缓冲区
- [ ] 索引缓冲区
- [ ] 纹理
- [ ] 帧缓冲
- [ ] 深度缓冲区
- [ ] 颜色缓冲区
- [ ] 模板缓冲区

- [ ] 模型矩阵
- [ ] 观察矩阵
- [ ] 投影矩阵 
- [ ] 视口

着色器是运行在显卡中的程序，以 GLSL 语言编写，开发者需要将着色器的源码以字符串的形式传给 WebGL 上下文的相关函数。

着色器有两种，顶点着色器和片元(像素)着色器，它们成对出现。顶点着色器任务是接收顶点的局部坐标，输出 CCV 坐标。CCV 坐标经过光栅化，转化为逐像素的数据，传给片元着色器。片元着色器的任务是确定每个片元的颜色。

顶点着色器接收的是 attribute 变量，是逐顶点的数据。顶点着色器输出 varying 变量，也是逐顶点的。逐顶点的 varying 变量数据经过光栅化，成为逐片元的 varying 变量数据，输入片元着色器，片元着色器输出的结果就会显示在 Canvas 上


参考链接：
[WebGL 技术储备指南](http://blog.csdn.net/happyduoduo1/article/details/51810137)

顶点坐标传入着色器:
1. 创建缓冲区对象
2. 将缓冲区对象绑定到target上
3. 将顶点数据写入缓冲区对象
4. 将缓冲区对象分配给对应的attribute变量
5. 开启attribute变量


图元装配: 将顶点坐标装配成几何图形, 几何图形的类别由gl.drawArrays的第一个参数决定
图元光栅化: 几何图形转化为片元

缓冲区对象 - 顶点着色器 - 图形装配 - 光栅化 - 片元着色器

给shader传递数据的方式:
buffer形式, 传递矩阵uniformMatrix4fv

纹理图像和纹理坐标:
纹理坐标是二维的, 并使用s和t命名纹理坐标, 以图像的左下角为原点, 原点向左为s的正方向, 向上为t的正方向, 且右上角的纹理坐标始终为(1, 1)。所以在使用图像前需要进行Y轴翻转
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1)， 使得原点在左上角。

WebGL中无法直接操作纹理对象, 必须通过将纹理对象绑定到纹理单元上， 然后通过操作纹理单元来操作纹理对象

三维世界：

观察者属性:
观察方向
可视距离

视点: 观察者所处的位置, 视线的起点
视线: 视点出发沿着观察方向的射线称作视线

默认情况下, 视点位于坐标原点, 视线为Z轴负半轴(指向屏幕内部)

观察目标点: 被观察目标所在的点, 可以用来确定视线的指向。
上方向: 最终绘制在屏幕上的影像中的向上的方向。当确定视点和观察点时，观察者还是可能以视线为轴旋转，所以需要上方向固定观察者。

我们可以根据视点, 观察目标点, 上方向创建一个**视图矩阵**，然后将该矩阵传给顶点着色器.与输入的顶点数据相乘。
cuon-matrix.js提供Matrix4.setLookAt(eyeX, eyeY, eyeZ, atX, atY, atZ, upX, upY, upZ)
eyeX, eyeY, eyeZ 指定视点
atX, atY, atZ 观察点
upX, upY, upZ 上方向

```
var matrix4 = new Matrix4();
matrix4.setLookAt(0, 0, 0, 0, 0, -1, 0, 1, 0)
```

视图矩阵viewMatrix和模型矩阵modelMatrix

模型视图矩阵
= 视图矩阵 x 模型矩阵 
= viewMatrix x modelMatrix 
= viewMatrix.multiply(modelMatrix)

可视范围:
WebGL只有物体在可视范围内才会去绘制

可视空间:
- 长方体可视空间, 正射投影
- 四棱锥可视空间, 透视投影

可视空间由两个矩形面确定
- 近裁剪面
- 远裁剪面

<canvas>上显示的就是可视空间中物体在近裁剪面上的投影，如果裁剪面的宽高比和canvas不一样, 那么画面就会被按照canvas的宽高比进行压缩，物体会被扭曲。

正交投影矩阵
Matrix4.setOrtho(left, right, bottom, top, near, far)

透视投影矩阵
Matrix4.setPerspective(fov, aspect, near, far)

投影矩阵用来确定可视空间
视图矩阵用来确定视线

三种矩阵
- 模型矩阵: 平移、旋转、缩放等变换的矩阵
- 视图矩阵: 确定观察点和视线方向
- 投影矩阵: 正交投影和透视投影, 用来确定可视空间

模型视图投影矩阵 = 模型矩阵 x 视图矩阵 x 投影矩阵

隐藏面消除: webgl绘制后绘制的会挡住先绘制的，使用下面的方式开启隐藏面消除
- 开启隐藏面消除 gl.enable(gl.DEPTH_TEST)
- 绘制前, 清除深度缓冲区 gl.clear(gl.DEPTH_BUFFER_BIT)

深度缓冲区: 存储几何图形的深度信息，也叫Z缓冲区，清除深度缓冲区就意味着消除绘制上一帧时留下的痕迹。同时清除颜色缓冲区可以通过按位或符号

深度冲突: 几何图形或物体的两个表面极为接近时出现的问题，导致表面看上去斑斑驳驳。使用多边形偏移。

多边形偏移: 该机制自动在Z值上加一个偏移量，该值由物体表面相对于观察者视线的角度确定。使用下面的方式开启
- 启用多边形偏移 gl.enable(gl.POLYGON_OFFSET_FILL)
- 绘制前指定用来计算偏移量的参数 gl.ploygonOffset(1.0, 2.0), 偏移量 = m * 1 + r * 2(m表示顶点所在表面相对于观察者的视线角度, r表示硬件能够区分两个Z轴只差的最小值)

索引缓冲区


光照
着色: 根据光照条件重建物体表面明暗不一的效果的过程

光源类型:
- 平行光: 光线平行的光
- 点光源光: 由一个点向周围发散
- 环境光: 从各个角度照射物体

光线反射方式:
- 漫反射: 反射光在各个方向是均匀的。反射光的颜色取决于入射光的颜色、表面的基底色、入射光与表面形成的入射角, 将**入射光与表面的法线形成的夹角叫入射角θ**.
漫反射光颜色 = 入射光颜色 x 表面基底色 x cosθ

- 环境反射: 针对环境光, 反射光的方向可以认为是入射光的反方向.
环境反射光颜色 = 入射光颜色 x 表面基底色

当漫反射和环境反射同时存在时
表面的发射光颜色 = 漫反射光颜色 + 环境反射光颜色

计算入射角:
cosθ = 光线方向 · 法线方向 (光线方向的矢量和法线方向的矢量长度必须为1)

归一化: 将一个矢量的长度调整为1，同时保持方向不变的过程

运动物体的光照效果:
- 平移物体不会改变法向量
- 旋转物体会改变法向量
- 缩放物体法向量的改变会比较复杂

逆转置矩阵: 逆矩阵的转置
逆矩阵: 矩阵M的逆矩阵是R, 那么R x M 或 M x R的结果都是单位矩阵
转置: 将矩阵的行列进行调换(沿左上-右下对角线进行翻转)

规则: 变换之前的法向量乘以模型矩阵的逆转置矩阵即可得到变换之后的法向量.



点光源光: 对点光源关下的物体进行着色时, 需要在每个入射点计算点光源光在该处的方向.